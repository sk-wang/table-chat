# Feature Specification: SSH 私钥文件选择器

**Feature Branch**: `014-ssh-key-file-picker`  
**Created**: 2025-12-31  
**Status**: Draft  
**Input**: User description: "SSH连接，私钥支持直接选文件"

## 概述

增强 SSH 隧道配置界面，支持用户直接选择本地私钥文件，而不必手动复制粘贴私钥内容。这是对 013-ssh-tunnel 功能的体验优化。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 通过文件选择器导入私钥 (Priority: P1)

数据库管理员在配置 SSH 隧道连接时，需要提供私钥进行认证。当前需要手动打开私钥文件、复制内容、粘贴到文本框，过程繁琐且容易出错。用户希望点击"选择文件"按钮，直接从系统文件选择器中选取私钥文件，系统自动读取并填入表单。

**Why this priority**: 这是核心需求，直接解决用户痛点，大幅提升配置 SSH 连接的效率。

**Independent Test**: 可以通过在 SSH 配置表单中测试文件选择功能来独立验证，无需实际连接数据库。

**Acceptance Scenarios**:

1. **Given** 用户在 SSH 隧道配置中选择"密钥认证"，**When** 用户查看私钥输入区域，**Then** 显示"选择文件"按钮和私钥文本框
2. **Given** 用户点击"选择文件"按钮，**When** 系统文件选择器打开，**Then** 用户可以浏览并选择本地私钥文件
3. **Given** 用户选择了一个有效的私钥文件，**When** 文件被选中，**Then** 文件内容自动读取并填入私钥文本框
4. **Given** 用户选择的文件读取成功，**When** 内容填入文本框后，**Then** 用户可以在文本框中查看和编辑私钥内容

---

### User Story 2 - 保留手动粘贴方式 (Priority: P1)

部分用户可能由于安全策略限制无法使用文件选择器，或者私钥存储在密码管理器中需要复制粘贴。系统应同时支持手动粘贴私钥内容。

**Why this priority**: 确保向后兼容，不因新功能而失去原有能力，支持多种使用场景。

**Independent Test**: 可以通过直接在文本框中粘贴私钥内容进行测试。

**Acceptance Scenarios**:

1. **Given** 用户在 SSH 配置中选择"密钥认证"，**When** 用户直接在私钥文本框中粘贴内容，**Then** 系统接受粘贴的私钥内容
2. **Given** 用户已通过文件选择器填入私钥，**When** 用户手动编辑或替换文本框内容，**Then** 系统使用手动输入的内容

---

### User Story 3 - 文件读取失败处理 (Priority: P2)

当用户选择的文件无法读取（权限问题、文件损坏、非文本文件等）时，系统应给出友好的错误提示，不影响用户继续操作。

**Why this priority**: 良好的错误处理提升用户体验，帮助用户快速定位问题。

**Independent Test**: 可以通过选择不同类型的文件（二进制文件、权限受限文件等）来测试错误处理。

**Acceptance Scenarios**:

1. **Given** 用户选择了一个无法读取的文件，**When** 系统尝试读取，**Then** 显示友好的错误提示（如"无法读取文件，请确认文件权限"）
2. **Given** 文件读取失败，**When** 错误提示显示后，**Then** 用户可以重新选择文件或手动粘贴

---

### Edge Cases

- 当用户选择超大文件（>1MB）时，提示文件过大，私钥文件通常小于 10KB
- 当用户选择二进制文件时，提示文件格式不正确
- 当用户取消文件选择对话框时，不做任何操作，保持原有状态
- 当用户多次选择文件时，新内容覆盖旧内容
- 当浏览器不支持文件读取 API 时，隐藏"选择文件"按钮，仅保留手动粘贴方式

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 在私钥输入区域提供"选择文件"按钮
- **FR-002**: 系统 MUST 使用浏览器原生文件选择器（`<input type="file">`）让用户选择本地文件
- **FR-003**: 系统 MUST 读取用户选择的文件内容，并将其填入私钥文本框
- **FR-004**: 系统 MUST 保留现有的手动粘贴私钥方式
- **FR-005**: 系统 MUST 在文件读取失败时显示友好的错误提示
- **FR-006**: 系统 MUST 支持常见的私钥文件格式（无扩展名、.pem、.key、id_rsa、id_ed25519 等）
- **FR-007**: 系统 MUST 限制可接受的文件大小（建议上限 100KB，私钥通常 <10KB）
- **FR-008**: 系统 MUST 在选择新文件后覆盖原有文本框内容

### Key Entities

- **私钥文件**: 用户本地的 SSH 私钥文件，包含 PEM 格式或 OpenSSH 格式的私钥内容
- **私钥输入组件**: 前端 UI 组件，包含文本框和文件选择按钮，负责收集私钥内容

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在 10 秒内完成私钥文件选择和导入（相比手动复制粘贴需要 30-60 秒）
- **SC-002**: 文件选择器支持选择任意文件类型（不限制扩展名过滤）
- **SC-003**: 文件读取成功率 100%（对于有效的文本文件）
- **SC-004**: 错误提示在 1 秒内显示
- **SC-005**: 原有的手动粘贴功能保持 100% 可用

## Assumptions

- 用户使用的浏览器支持 File API（所有现代浏览器均支持）
- 私钥文件是文本格式，可以通过 FileReader 读取为字符串
- 私钥文件大小通常小于 10KB
- 文件选择器只需单选功能，不需要多选
- 不需要支持拖拽上传（可作为未来增强）

## Out of Scope

- 不支持从服务器路径读取私钥文件（浏览器安全限制）
- 不在前端校验私钥格式有效性（后端已有校验）
- 不支持拖拽上传功能（可作为未来增强）
- 不支持记住最近选择的文件路径（浏览器安全限制）

## Dependencies

- 依赖 013-ssh-tunnel 功能已实现的 SSH 配置表单
