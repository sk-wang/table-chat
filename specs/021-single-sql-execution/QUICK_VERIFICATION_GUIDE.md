# 快速验证指南 - DMS风格单条SQL执行

## 🚀 如何测试新功能

### 1. 启动应用

```bash
cd frontend
npm run dev
```

打开浏览器访问 http://localhost:5173

### 2. 准备测试SQL

在SQL编辑器中输入以下测试SQL：

```sql
SELECT * FROM users LIMIT 10;

SELECT COUNT(*) FROM orders WHERE status = 'pending';

SELECT
    u.id,
    u.username,
    COUNT(o.id) as order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.username;
```

### 3. 测试清单

#### ✅ 测试1: 实时高亮

- [ ] 将光标放在第1条SQL（users查询）
- [ ] 验证：第1行 `SELECT * FROM users LIMIT 10;` 被高亮（左侧蓝色边框）
- [ ] 将光标移动到第2条SQL（orders查询）
- [ ] 验证：高亮立即切换到第2行
- [ ] 将光标移动到第3条多行SQL的任意行（如第7行）
- [ ] 验证：整个多行语句（第5-10行）都被高亮

#### ✅ 测试2: 装订线按钮

- [ ] 将光标放在第1条SQL
- [ ] 验证：第1行左侧装订线出现蓝色 ▶️ 图标
- [ ] 点击 ▶️ 图标
- [ ] 验证：只执行第1条SQL，结果显示users表数据

#### ✅ 测试3: F8快捷键

- [ ] 将光标放在第2条SQL（orders查询）
- [ ] 按 **F8** 键
- [ ] 验证：只执行第2条SQL，结果显示待处理订单数量
- [ ] 将光标移回第1条SQL
- [ ] 按 **F8** 键
- [ ] 验证：重新执行第1条SQL

#### ✅ 测试4: Ctrl/Cmd+Enter快捷键

- [ ] 将光标放在第3条多行SQL（第7行）
- [ ] 按 **Ctrl+Enter** (Windows/Linux) 或 **Cmd+Enter** (Mac)
- [ ] 验证：执行完整的多行SQL，显示用户订单统计

#### ✅ 测试5: 选择执行

- [ ] 用鼠标选中第2条SQL的一部分：`COUNT(*) FROM orders`
- [ ] 按 **F8** 键
- [ ] 验证：只尝试执行选中的文本（可能报错，符合预期）
- [ ] 用鼠标选中完整的第1条SQL：`SELECT * FROM users LIMIT 10;`
- [ ] 按 **F8** 键
- [ ] 验证：执行选中的完整SQL

#### ✅ 测试6: 边界情况 - 空行

- [ ] 在第1条和第2条SQL之间添加一个空行
- [ ] 将光标放在空行
- [ ] 验证：高亮自动跳转到最近的语句（向前优先）

#### ✅ 测试7: 边界情况 - 字符串中的分号

添加以下SQL测试：

```sql
SELECT * FROM products WHERE description = 'Price: $10; Brand: Apple';
SELECT * FROM categories;
```

- [ ] 将光标放在第1条SQL
- [ ] 验证：高亮整个第1行（不会因字符串中的`;`而分割）
- [ ] 按 **F8** 执行
- [ ] 验证：正确执行完整语句

#### ✅ 测试8: 边界情况 - 注释

添加以下SQL测试：

```sql
-- 旧查询：SELECT * FROM old_users; (已废弃)
SELECT * FROM new_users;
```

- [ ] 将光标放在第2行（new_users查询）
- [ ] 验证：只高亮第2行，忽略注释中的SQL
- [ ] 按 **F8** 执行
- [ ] 验证：正确执行new_users查询

---

## 🎨 视觉效果验证

### 高亮样式

**预期效果**:
- 当前语句左侧有蓝色竖线（3-4px宽）
- 语句背景有半透明蓝色高亮
- 深色主题下：`rgba(30, 144, 255, 0.1)` 背景色
- 边框：`rgba(30, 144, 255, 0.3)` 颜色

### 装订线按钮

**预期效果**:
- 蓝色三角形 ▶️ 图标
- 位置：行号左侧装订线区域
- 鼠标悬停：透明度从 0.7 → 1.0
- 悬停提示："Click to execute (F8)"
- 点击后：立即执行SQL

---

## 🐛 常见问题排查

### 问题1: 看不到高亮

**原因**:
- SQL语法错误
- 编辑器未获得焦点
- 光标在空行或注释行

**解决**:
1. 检查SQL语法
2. 点击编辑器区域获得焦点
3. 将光标移动到有效SQL语句内

### 问题2: F8没反应

**原因**:
- 浏览器拦截了F8键
- 编辑器未获得焦点
- JavaScript错误

**解决**:
1. 打开浏览器开发者工具（F12）查看Console是否有错误
2. 尝试使用 Ctrl/Cmd+Enter 替代
3. 尝试点击装订线的 ▶️ 按钮

### 问题3: 装订线按钮不显示

**原因**:
- 光标不在SQL语句内
- 浏览器缩放比例不是100%
- 编辑器样式未加载

**解决**:
1. 将光标移动到SQL语句的第一行
2. 重置浏览器缩放到100%
3. 刷新页面

### 问题4: 多行SQL只高亮部分行

**原因**:
- SQL语法错误导致解析失败
- 缺少分号分隔符

**解决**:
1. 确保SQL语法正确
2. 在多条SQL之间加上分号 `;`

---

## 📊 性能验证

### 1. 解析性能

**测试方法**:
1. 打开浏览器开发者工具（F12）
2. 切换到 Performance 标签
3. 开始录制
4. 在编辑器中粘贴50条SQL语句
5. 停止录制
6. 查看 `parseStatements()` 执行时间

**预期结果**: < 50ms

### 2. 高亮性能

**测试方法**:
1. 打开 Performance 标签
2. 开始录制
3. 快速移动光标在不同SQL语句之间（移动10次）
4. 停止录制
5. 查看每次 `updateHighlight()` 的帧时间

**预期结果**: 每次 < 16ms（60fps）

### 3. 内存泄漏检测

**测试方法**:
1. 打开 Memory 标签
2. 拍摄堆快照（Heap Snapshot）
3. 移动光标50次
4. 再次拍摄堆快照
5. 比较两次快照的内存差异

**预期结果**: 内存增长 < 1MB

---

## ✅ 完整功能验证清单

### 核心功能
- [ ] 实时语句高亮（光标移动时立即更新）
- [ ] 装订线执行按钮（▶️ 图标显示和点击）
- [ ] F8 快捷键执行
- [ ] Ctrl/Cmd+Enter 快捷键执行
- [ ] 选择优先执行策略

### 多语句支持
- [ ] 单行SQL正确识别
- [ ] 多行SQL正确识别（完整高亮）
- [ ] 多条SQL分别识别（分号分隔）
- [ ] 光标在空行时自动查找最近语句

### 边界情况
- [ ] 字符串中的分号不分割语句
- [ ] 单引号字符串支持
- [ ] 双引号字符串支持
- [ ] 块注释 `/* */` 中的SQL被忽略
- [ ] 行注释 `--` 中的SQL被忽略
- [ ] 行注释 `#` (MySQL) 中的SQL被忽略

### 性能
- [ ] 50条SQL解析 < 50ms
- [ ] 高亮更新 < 16ms (60fps)
- [ ] 光标跟踪有50ms防抖（不闪烁）
- [ ] 无内存泄漏

### 用户体验
- [ ] 高亮颜色清晰可见
- [ ] 装订线按钮易于点击
- [ ] 悬停提示文字清晰
- [ ] 快捷键响应迅速
- [ ] 选择文本后执行符合预期

---

## 🎉 验证成功标准

如果以上所有测试项都通过（✅），则功能验证成功，可以发布使用！

**预期体验**:
- 像使用阿里云DMS一样流畅
- 光标移动，高亮实时跟随
- 点击装订线或按F8立即执行
- 多条SQL独立执行，互不干扰

---

## 📝 验证报告模板

```markdown
# 单条SQL执行功能验证报告

**验证人**: _______________
**验证日期**: 2026-01-__
**浏览器**: Chrome / Firefox / Safari
**版本**: _______________

## 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 实时高亮 | ✅ / ❌ |  |
| 装订线按钮 | ✅ / ❌ |  |
| F8快捷键 | ✅ / ❌ |  |
| Ctrl/Cmd+Enter | ✅ / ❌ |  |
| 选择执行 | ✅ / ❌ |  |
| 多行SQL | ✅ / ❌ |  |
| 字符串边界 | ✅ / ❌ |  |
| 注释处理 | ✅ / ❌ |  |
| 性能表现 | ✅ / ❌ |  |

## 问题与建议

（如有问题，请详细描述）

## 总体评价

- [ ] 完全符合预期，可以发布
- [ ] 基本符合预期，但需要优化
- [ ] 不符合预期，需要修复

---
签名: _______________
```

---

**祝测试顺利！** 🚀
